# ============================================
# API Gateway Environment Configuration
# ============================================
# Copy this file to .env and customize for your environment
#
# Usage:
#   cp env.example .env
#   # Edit .env with your values
#   docker compose -f docker-compose.prod.yml up -d
# ============================================

# ==========================================
# REQUIRED - Core Settings
# ==========================================

# Environment: development, production, test
NODE_ENV=production

# Server port
PORT=3000

# ==========================================
# SECURITY
# ==========================================

# Trust proxy headers (set to true if behind load balancer/nginx)
TRUST_PROXY=true

# CORS allowed origins (comma-separated for multiple)
# Examples:
#   Single origin: https://app.example.com
#   Multiple: https://app.example.com,https://admin.example.com
#   All (not recommended for production): *
CORS_ORIGIN=https://app.example.com

# Allow credentials in CORS requests
CORS_CREDENTIALS=true

# ==========================================
# REDIS - Distributed Rate Limiting
# ==========================================

# Redis connection URL (required for multi-instance deployments)
# If not set, falls back to in-memory rate limiting
# Format: redis://[username:password@]host:port[/database]
REDIS_URL=redis://localhost:6379

# ==========================================
# RATE LIMITING
# ==========================================

# Time window for rate limiting (milliseconds)
RATE_LIMIT_WINDOW_MS=60000

# Maximum requests per window (per IP)
RATE_LIMIT_MAX=1000

# Strict rate limit for sensitive endpoints
RATE_LIMIT_STRICT_MAX=10

# ==========================================
# TIMEOUTS (milliseconds)
# ==========================================

# Client request timeout
REQUEST_TIMEOUT_MS=30000

# Upstream service timeout
UPSTREAM_TIMEOUT_MS=60000

# Health check timeout
HEALTH_CHECK_TIMEOUT_MS=5000

# Graceful shutdown timeout
SHUTDOWN_TIMEOUT_MS=30000

# ==========================================
# RETRY CONFIGURATION
# ==========================================

# Maximum retry attempts for failed requests
MAX_RETRIES=3

# Initial retry delay (milliseconds)
RETRY_INITIAL_DELAY_MS=100

# Maximum retry delay (milliseconds)
RETRY_MAX_DELAY_MS=2000

# Exponential backoff factor
RETRY_FACTOR=2

# ==========================================
# CIRCUIT BREAKER
# ==========================================

# Request timeout before circuit considers it failed
CIRCUIT_BREAKER_TIMEOUT_MS=10000

# Error percentage threshold to open circuit (1-100)
CIRCUIT_BREAKER_ERROR_THRESHOLD=50

# Time to wait before attempting to close circuit
CIRCUIT_BREAKER_RESET_TIMEOUT_MS=30000

# ==========================================
# HEALTH CHECKS
# ==========================================

# Interval between upstream health checks
HEALTH_CHECK_INTERVAL_MS=10000

# Consecutive failures before marking unhealthy
HEALTH_CHECK_UNHEALTHY_THRESHOLD=3

# Consecutive successes before marking healthy
HEALTH_CHECK_HEALTHY_THRESHOLD=2

# ==========================================
# CONNECTION POOLING
# ==========================================

# Maximum concurrent connections per upstream
MAX_SOCKETS=256

# Maximum idle connections to keep alive
MAX_FREE_SOCKETS=64

# ==========================================
# LOGGING
# ==========================================

# Log level: error, warn, info, http, verbose, debug, silly
LOG_LEVEL=info

# ==========================================
# GATEWAY CONFIGURATION
# ==========================================

# Path to gateway.yaml configuration file
GATEWAY_CONFIG_PATH=./gateway.yaml
