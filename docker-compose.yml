version: '3.8'

services:
    gateway:
        build: .
        ports:
            - '3000:3000'
        # This extra setting allows the container to talk to your
        # Windows/Linux host machine using 'host.docker.internal'
        extra_hosts:
            - 'host.docker.internal:host-gateway'
        volumes:
            - ./gateway.yaml:/app/gateway.yaml
            - ./plugins:/app/plugins
        healthcheck:
            test:
                [
                    'CMD',
                    'node',
                    '-e',
                    "require('http').get('http://localhost:3000/health', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"
                ]
            interval: 30s
            timeout: 10s
            retries: 3
            start_period: 40s
